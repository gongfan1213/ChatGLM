### 基于GLM智能体虚拟角色养成系统
#### 基于GLM智能体虚拟角色养成系统V1.0
| 首页 | 头像 | 修改密码 | 退出 |
| ---- | ---- | ---- | ---- |
| 对话 | **智能体名称** | **智能体信息** | **更多** |
| 创建智能体 |  |  | **修改** |
| 账号管理 |  | 对话栏 | **删除** |
|  |  |  | **新建会话** |
|  | 请输入 |  | 发送 |

![image](https://github.com/user-attachments/assets/2e9b2745-73d6-40eb-a590-03aa6f157569)


### 图15 - 10 对话页面设计图
#### 6. 修改智能体页面
如图15 - 11所示，修改智能体页面可以修改智能体类型、智能体名称、智能体简介和智能体头像。

![image](https://github.com/user-attachments/assets/fa6e15fa-bcec-40b9-898e-225e889f477b)


### 修改智能体信息
| 智能体分类 | 请选择具体类型 |
| ---- | ---- |
| 智能体名称 | 请输入智能体名称 |
| 智能体简介 | 请输入智能体的简介 |
| 智能体头像生成 | 请输入头像描述 |
|  | 生成头像 |
|  | 确定 |

### 图15 - 11 修改智能体页面设计图
#### 7. 创建智能体页面
如图15 - 12所示，创建智能体界面需要用户选择智能体类型、输入智能体名称和智能体的简介，智能体头像生成是可选功能，不单击系统默认设计智能体头像。知识库文件是当用户要创建长文档解读智能体时，需要单击上传按钮来上传知识库文件。当填写完所有信息后，单击“立即创建”按钮就能成功创建智能体了。

![image](https://github.com/user-attachments/assets/5e6ac505-3e05-4d14-96a0-80f937638488)


### 基于GLM智能体虚拟角色养成系统V1.0
| 首页 | 头像 | 修改密码 | 退出 |
| ---- | ---- | ---- | ---- |
| 对话 | **智能体分类** | 请选择类型 |
| 创建智能体 |  | 科技 |
| 账号管理 |  | 美食 |
|  |  | **智能体名称** |
|  |  | 请输入名称 |
|  |  | **智能体简介** |
|  |  | 请输入智能体的简介 |
|  |  | **智能体头像生成** | **知识库文件** |
|  |  | 请输入头像描述 | 点击上传 |
|  |  | 生成头像 |  |
|  |  | 立即创建 |  |

### 图15 - 12 创建智能体页面设计图
#### 8. 账号管理页面
如图15 - 13所示，账号管理页面是用于对用户信息进行管理操作，管理员在该页面能看到创建了账号的所有系统用户。单击“新增账户”进入新增账号页面，新增账号页面同注册页面，如图15 - 7所示。单击编辑进入编辑账户页面，编辑账户页面同修改个人信息页面，如图15 - 9所示。单击“删除”对账户进行删除操作。单击“智能体管理”进入智能体管理页面。

### 基于GLM智能体虚拟角色养成系统V1.0
| 首页 | 头像 | 修改密码 | 退出 |
| ---- | ---- | ---- | ---- |
| 对话 |  |  |  |
| 创建智能体 |  |  |  |
| 账号管理 |  |  |  |

![image](https://github.com/user-attachments/assets/afc2beb8-83f1-48ee-9abf-5fbf410b32a7)


### 图15 - 13 账号管理页面设计图
#### 9. 智能体管理页面
如图15 - 14所示，智能体管理页面用于对用户创建的智能体进行管理操作，管理员在该页面可以看到某个用户创建的所有智能体。单击编辑进入编辑智能体页面，编辑智能体页面同修改智能体页面，如图15 - 11所示。单击“删除”将对智能体进行删除操作。

### 基于GLM智能体虚拟角色养成系统V1.0
| 首页 | 头像 | 修改密码 | 退出 |
| ---- | ---- | ---- | ---- |
| 对话 |  |  |  |
| 创建智能体 |  |  |  |
| 账号管理 |  |  |  |

![image](https://github.com/user-attachments/assets/c7df9bd4-34cf-4afc-9fb0-46750934cc56)


### 图15 - 14 智能体管理页面设计图
### 15.4 系统实现
本节仅给出GAS上具有代表性的几个接口和页面的实现过程，完整的系统实现代码见本项目的GitHub代码库“https://github.com/Shuzhimin/CharaterAI”。下面将分别介绍系统接口和前端页面的实现过程。
### 15.4.1 后端接口实现
#### 1. 接口设计
接口设计是基于需求分析、功能设计以及数据库的概念和逻辑设计进行的。为了前后端开发的便利，提高开发效率，本系统采用前后端分离的架构来开发，选择使用FastAPI来实现后端接口的编码，FastAPI是基于Python的高性能Web框架，以其出色的异步性能、自动生成的交互式API文档、强大的类型注解支持、简洁的语法和丰富的生态系统而受到开发者的青睐。它专为构建快速、高效且易于维护的RESTful API而设计，支持异步编程，能够显著提高开发效率，减少人为错误，并提供良好的开发者体验。
本系统将后端接口划分为5个主要部分（智能体管理、用户管理、头像生成、对话和管理员），共包含18个接口。以下将定义和描述这些接口的具体功能、参数以及返回值。
##### （1）智能体管理
智能体管理包含4个接口：创建智能体接口、删除智能体接口、修改智能体接口、查询智能体接口。主要是实现了对智能体的增删改查功能，下面将详细描述这4个接口。
###### 接口1.1 创建智能体接口
**功能描述**：创建用于对话的智能体，其中可以选择是否共享创建的智能体，即is_shared:true。
**参数**：
| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| uid | 用户ID | 是 | int |
| name | 智能体名称 | 是 | str |
| description | 智能体描述 | 是 | str |
| avatar_description | 头像文本描述 | 否 | str |
| avatar_url | 头像url | 是 | str |
| category | 类别 | 是 | str |
| is_shared | 是否共享 | 是 | str |
| file | 知识库文件 | 否 | file |
**返回值**：
```json
{
    "cid": 0,
    "name": "string",
    "description": "string",
    "category": "string",
    "avatar_description": "string",
    "avatar_url": "string",
    "created_at": "2024-05-12T13:46:32.642Z",
    "updated_at": "2024-05-12T13:46:32.642Z",
    "is_shared": true,
    "uid": 0
}
```
###### 接口1.2 删除智能体接口
**功能描述**：根据cid列表删除已创建的对应智能体（逻辑删除，status设为delete），用户只能删除自己创建的智能体，不能删除管理员创建的智能体，管理员可以删除任意智能体。
**参数**：
| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| cid | 智能体ID | 是 | list[int] |
**返回值**：null
###### 接口1.3 修改智能体接口
**功能描述**：对已创建的智能体进行修改，用户只能修改自己创建的智能体，不能修改管理员创建的智能体，管理员可以修改任意智能体。

**参数**：

| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| cid | 智能体ID | 是 | int |
| name | 智能体名称 | 是 | str |
| description | 智能体描述 | 是 | str |
| avatar_description | 头像文本描述 | 否 | str |
| avatar_url | 头像url | 是 | str |
| category | 类别 | 是 | str |

**返回值**：
```json
{
    "cid": 0,
    "name": "string",
    "description": "string",
    "category": "string",
    "avatar_description": "string",
    "avatar_url": "string",
    "created_at": "2024-05-12T13:58:05.337Z",
    "updated_at": "2024-05-12T13:58:05.337Z",
    "is_shared": true,
    "uid": 0
}
```
###### 接口1.4 查询智能体接口

**功能描述**：用户可以分页获取智能体的信息。

**参数**：
| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| cid | 智能体ID | 否 | int |
| category | 类别 | 否 | str |
| page_num | 页码 | 否 | int |
| page_size | 每页数量 | 否 | int |

**返回值**：

```json
[
    {
        "cid": 0,
        "name": "string",
        "description": "string",
        "category": "string",
        "avatar_description": "string",
        "avatar_url": "string",
        "created_at": "2024-05-12T14:02:25.972Z",
        "updated_at": "2024-05-12T14:02:25.972Z",
        "is_shared": true,
        "uid": 0
    }
]
```
##### （2）用户管理

用户管理包含5个接口：登录接口、注册接口、修改用户信息接口、修改密码接口和查询自身信息接口。下面将详细描述这5个接口。

###### 接口2.1 登录接口

**功能描述**：用于根据系统账号登录系统。

**参数**：

| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| username | 用户名 | 是 | str |
| password | 密码 | 是 | str |
**返回值**：
```json
{
    "access_token": "string",
    "token_type": "string"
}
```
###### 接口2.2 注册接口

**功能描述**：用于普通用户注册系统账号。

**参数**：

| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| username | 用户名 | 是 | str |
| password | 密码 | 是 | str |
| avatar_description | 头像文本描述 | 否 | str |
| avatar_url | 头像url | 是 | str |
**返回值**：
```json
{
    "uid": 0,
    "name": "string",
    "avatar_description": "string",
    "avatar_url": "string",
    "role": "string",
    "created_at": "2024-05-12T14:13:31.378Z",
    "updated_at": "2024-05-12T14:13:31.378Z"
}
```
###### 接口2.3 修改用户信息接口
**功能描述**：用于修改用户名和用户头像。

**参数**：

| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| username | 用户名 | 否 | str |
| avatar_description | 头像文本描述 | 否 | str |
| avatar_url | 头像url | 否 | str |

**返回值**：

```json
{
    "uid": 0,
    "name": "string",
    "avatar_description": "string",
    "avatar_url": "string",
    "role": "string",
    "created_at": "2024-05-12T14:16:47.401Z",
    "updated_at": "2024-05-12T14:16:47.401Z"
}
```
###### 接口2.4 修改密码接口

**功能描述**：用于修改用户密码。

**参数**：

| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| old_password | 旧的密码 | 是 | str |
| new_password | 新的密码 | 是 | str |

**返回值**：

```json
{
    "uid": 0,
    "name": "string",
    "avatar_description": "string",
    "avatar_url": "string",
    "role": "string",
    "created_at": "2024-05-12T14:18:14.075Z",
    "updated_at": "2024-05-12T14:18:14.075Z"
}
```
###### 接口2.5 查询自身信息接口

**功能描述**：用户查询用户自身信息的接口。

**参数**：无。

**返回值**：
```json
{
    "uid": 0,
    "name": "string",
    "avatar_description": "string",
    "avatar_url": "string",
    "role": "string",
    "created_at": "2024-05-12T14:21:43.386Z",
    "updated_at": "2024-05-12T14:21:43.386Z"
}
```
##### （3）头像生成

头像生成内只含有一个接口，如下所示。

###### 接口3.1 头像生成接口

**功能描述**：根据输入的文本描述生成符合其内容的头像。

**参数**：

| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| avatar_description | 头像文本描述 | 否 | str |

**返回值**：图片的url。

##### （4）对话

对话部分共包含3个接口：对话接口、查询会话接口和删除会话接口。下面将具体介绍这些接口。

###### 接口4.1 对话接口

**功能描述**：与创建好的智能体进行对话。

**参数**：

| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| cid | 智能体ID | 是 | int |
| chat_id | 会话ID | 是 | int |
| token | 用户身份信息标识 | 是 | int |
| sender | 消息发送者的ID | 是 | str |
| receiver | 消息接收者的ID | 是 | int |
| is_end_of_stream | 是否用流式输出 | 是 | bool |
| content | 发送内容 | 是 | str |

**返回值**：

```json
{
    "sender": int,
    "receiver": int,
    "is_end_of_stream": bool,
    "content": string,
    "images": list[string]
}
```
###### 接口4.2 查询会话接口

**功能描述**：查询已经创建的会话，可以查看聊天的历史记录。

**参数**：

| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| cid | 智能体ID | 否 | int |
| chat_id | 会话ID | 否 | int |
**返回值**：
```json
{
    "chat_id": 0,
    "uid": 0,
    "cid": 0,
    "create_at": "2024-05-12T14:44:26.785Z",
    "history": [
        {
            "content": "string",
            "sender": "string",
            "created_at": "2024-05-12T14:44:26.785Z"
        }
    ]
}
```
###### 接口4.3 删除会话接口

**功能描述**：删除已创建的会话。

**参数**：

| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| chat_id | 会话ID | 是 | list[int] |

**返回值**：null。

##### （5）管理员

管理员部分含有5个接口分别是修改用户信息接口、修改用户角色接口、删除用户接口、查询用户接口和查询智能体接口。其中修改用户信息接口同接口2.3，下面将不再介绍。

###### 接口5.1 修改用户角色接口

**功能描述**：用于管理员修改用户角色，用户角色有user和admin。

**参数**：

| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| uid | 用户ID | 是 | int |
| role | 用户角色 | 是 | int |

**返回值**：null

###### 接口5.2 删除用户接口

**功能描述**：用于管理员删除用户，删除是逻辑删除。
**参数**：
| 参数名 |

| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| uid | 用户ID | 是 | list[int] |
**返回值**：null

###### 接口5.3 查询用户接口

**功能描述**：用户管理员查询用户，支持模糊查询。

**参数**：

| 参数名 | 参数简介 | 是否必选 | 类型 |
| ---- | ---- | ---- | ---- |
| query | 查询的用户名 | 否 | str |
| page_num | 页码 | 否 | int |
| page_size | 每页数量 | 否 | int |

**返回值**：

```json
{
    "users": [
        {
            "uid": 0,
            "name": "string",
            "avatar_description": "string",
            "avatar_url": "string",
            "role": "string",
            "created_at": "2024-05-12T15:01:42.225Z",
            "updated_at": "2024-05-12T15:01:42.225Z"
        }
    ],
    "scores": [
        0
    ],
    "total": 0
}
``` 
